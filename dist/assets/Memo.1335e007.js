import{l as e,o as t,v as a,a as n,w as l,y as s,T as o,U as i,x as c,V as r,q as u,c as v,W as d,X as p,m as g,Y as f,Z as m,F as h,J as y,B as w,_ as x,p as C,k,s as L,n as b,M as _,t as M,N as E,$ as H,K as A,a0 as S,a1 as z,P as T,E as q}from"./vendor.680f2693.js";import{u as B,h as I}from"./moment.a4e02963.js";import"./index.75ec14bb.js";var P=e({name:"Check"});const V={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},D=n("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"},null,-1);P.render=function(e,n,l,s,o,i){return t(),a("svg",V,[D])},P.__file="packages/components/Check.vue";var U=P,Y=e({name:"Edit"});const j={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},$=n("path",{fill:"currentColor",d:"M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640V512z"},null,-1),N=n("path",{fill:"currentColor",d:"m469.952 554.24 52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"},null,-1);Y.render=function(e,n,l,s,o,i){return t(),a("svg",j,[$,N])},Y.__file="packages/components/Edit.vue";var R=Y,W=e({name:"Refresh"});const K={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},O=n("path",{fill:"currentColor",d:"M771.776 794.88A384 384 0 0 1 128 512h64a320 320 0 0 0 555.712 216.448H654.72a32 32 0 1 1 0-64h149.056a32 32 0 0 1 32 32v148.928a32 32 0 1 1-64 0v-50.56zM276.288 295.616h92.992a32 32 0 0 1 0 64H220.16a32 32 0 0 1-32-32V178.56a32 32 0 0 1 64 0v50.56A384 384 0 0 1 896.128 512h-64a320 320 0 0 0-555.776-216.384z"},null,-1);W.render=function(e,n,l,s,o,i){return t(),a("svg",K,[O])},W.__file="packages/components/Refresh.vue";var F=W,J=e({name:"Search"});const X={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},Z=n("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704z"},null,-1);J.render=function(e,n,l,s,o,i){return t(),a("svg",X,[Z])},J.__file="packages/components/Search.vue";var G=J;function Q(e){return Number(e.replace(/px$/,""))}function ee(e,t,a){const n=e,v=B(),{tagList:d}=r(v);l(!1);const{textareaContent:p,insertContent:g,computeSelectPos:f}=function(e){const t=l(""),a=l(e);s(t,(()=>{a.value.style.height="auto",a.value.style.height=a.value.scrollHeight+"px"})),o(a,"input",(e=>{t.value=e.target.value}));const n=e=>{const{selectionEnd:n}=a.value,l=n,s=t.value,o=s.slice(0,n)+e+s.slice(n);t.value=o,a.value.blur(),i((()=>{a.value.selectionEnd=l+e.length,a.value.focus()}))},r=c();return s((()=>r.query),(()=>{const{tag:e}=r.query;i(e?()=>{t.value="",n(`#${e} `)}:()=>{t.value=""})}),{immediate:!0}),{textareaContent:t,insertContent:n,computeSelectPos:()=>{const e=a.value,{offsetLeft:t,offsetTop:n,selectionEnd:l}=e,s=document.createElement("div"),o=window.getComputedStyle(e);let i="0px",c="0px";for(const a of Array.from(o)){const e=o.getPropertyValue(a);"width"===a&&(i=e),"height"===a&&(c=e),s.style.setProperty(a,e)}s.style.position="fixed",s.style.visibility="hidden",s.style.whiteSpace="pre-wrap",s.innerHTML=e.value.slice(0,l);const r=document.createElement("span");r.innerHTML=e.value.slice(l),s.appendChild(r),document.body.appendChild(s);const u=r.offsetLeft,v=r.offsetTop;return document.body.removeChild(s),{x:t+u,y:n+v,containerWidth:Q(i),containerHeight:Q(c)}}}}(t),m=l(!1);s(m,((e=!0)=>{if(!e)return;const{x:t,y:a,containerWidth:l,containerHeight:s}=f();let o=t+15+"px",i=a+22+"px";return l-Q(o)<150&&(o=`calc( ${o} + -50% )`),Q(i)>s&&(i=s+22+"px"),n.value.style.top=""+i,n.value.style.left=""+o,!1}));const h=d,y=(e=1)=>{const t=h.value,a=()=>{t.forEach((e=>{e.active=!1}))};if(1===e){const e=t.findIndex((e=>e.active));a();const n=e+1<t.length?e+1:0;t[n].active=!0}else{const e=t.findIndex((e=>e.active));a();t[e-1>0?e-1:0].active=!0}};o(t,"keydown",(e=>{const t=e.key;if(0!==u(d).length){if("#"===t)return m.value=!0,!1;if("Enter"==e.key&&e.ctrlKey&&a(),m.value){if("Backspace"===t)return void(m.value=!1);if(["ArrowUp","Enter"," "].includes(t)&&(e.stopPropagation(),e.preventDefault()),"ArrowUp"===t?y(-1):"ArrowDown"===t&&y(1),"Enter"===t||" "===t){const e=h.value.find((e=>e.active));g(e.content+" "),m.value=!1}}}})),o(t,"input",(e=>{"#"===p.value.charAt(p.value.length-1)&&u(d).length&&(m.value=!0)}));return document.onclick=()=>{m.value=!1},{textareaContent:p,shouldSuggestionShow:m,itemClicked:e=>{const t=e.target.innerText;g(t+" ")},suggestionList:h,handleIconClick:e=>{if(e.preventDefault(),e.stopPropagation(),g("#"),0===d.value.length)return!1;m.value=!0}}}C("data-v-bff37ec8");const te={class:"editor"},ae={class:"bar"},ne=["disabled"],le={class:"loading-box"};k();var se=e({setup(e){const a=e=>{e&&(e.preventDefault(),e.stopPropagation()),A.value=!0,E()},n=l(null),o=l(null),{textareaContent:i,shouldSuggestionShow:r,handleIconClick:C,itemClicked:k,suggestionList:_}=ee(n,o,a),M=c(),E=()=>{const e={tags:H(i.value),content:i.value},t=B();t.save(e).then((e=>{A.value=!1,console.log(e),i.value="";const a=M.query.tag;a&&t.getArticleList({tag:a})}))};s(i,(()=>{}));const H=e=>Array.from(e.match(/#[^\s(?<!#)]+/g)||[]).map((e=>e.slice(1))),A=l(!1);return s(r,(e=>{console.log("shouldSuggestionShow:",e)})),(e,l)=>(t(),v("div",te,[d(g("textarea",{"onUpdate:modelValue":l[0]||(l[0]=e=>f(i)?i.value=e:null),name:"text-input",ref:o},null,512),[[p,u(i)]]),d(g("div",{class:"suggestion",ref:n,onClick:l[1]||(l[1]=e=>u(k)(e))},[(t(!0),v(h,null,y(u(_),(e=>(t(),v("span",{class:L({active:e.active})},b(e.content),3)))),256))],512),[[m,u(r)]]),g("div",ae,[g("span",{class:"tag-icon",onClick:l[2]||(l[2]=e=>u(C)(e))}," # "),g("button",{class:"save",onClick:l[3]||(l[3]=w((e=>a(e)),["prevent"])),disabled:u(x)(u(i))}," 发送 ",8,ne)]),d(g("div",le,"loading...",512),[[m,A.value]])]))}});se.__scopeId="data-v-bff37ec8";C("data-v-32e63f84");const oe={class:"card"},ie={class:"header"},ce={class:"time-text"},re={class:"more"},ue=g("svg",{width:"16px",height:"16px",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[g("path",{"fill-rule":"evenodd",d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"})],-1),ve=[g("li",{"data-type":"get-link"},"复制链接",-1),g("li",{"data-type":"set-top"},"置顶",-1),g("li",{"data-type":"detail"},"查看详情",-1),g("li",{"data-type":"edit"},"编辑",-1),g("li",{"data-type":"delete"},"删除",-1)],de=["innerHTML"],pe={class:"footer"},ge={class:"tag-view"},fe=["onClick"];k();var me=e({props:{article:{type:Object,default:{}},isLast:{type:Boolean,default:!1}},setup(e){const a=e,l=B(),s=_();let{article:o}=M(a);const i=E((()=>{I.locale(navigator.language);const e=I.utc(o.value.updateTime).local();return e.diff(I(),"day")<0?e.format("YYYY-MM-DD HH:mm:ss"):e.fromNow()}));return(e,c)=>(t(),v("li",oe,[g("div",ie,[g("span",ce,b(u(i)),1),g("div",re,[n(u(H),{placement:a.isLast?"top":"bottom",trigger:"hover"},{reference:A((()=>[ue])),default:A((()=>[g("ul",{onClick:c[0]||(c[0]=e=>(e=>{switch(e.target.dataset.type){case"delete":l.deleteArticle(+a.article.id)}})(e)),class:"popover-list"},ve)])),_:1},8,["placement"])])]),g("div",{innerHTML:u(o).content.replace(/[\r\n]/g,"<br />"),class:"content"},null,8,de),g("div",pe,[g("ul",ge,[(t(!0),v(h,null,y(u(o).tags,(e=>(t(),v("li",{key:e.content,onClick:w((t=>{return a=e.content,void s.push({name:"memo",query:{tag:a}});var a}),["prevent"])}," #"+b(e.content),9,fe)))),128))])])]))}});me.__scopeId="data-v-32e63f84",C("data-v-79554d20");const he={class:"title-wrp"},ye={key:0,style:{display:"inline"}},we=g("span",{class:"line"},"/",-1),xe={class:"lastTag"};k();var Ce=e({setup(e){const a=c(),s=E((()=>a.query.tag))||l(""),o=l("");S((()=>{o.value=a.query.tag}));const i=_(),r=e=>{i.push({name:"memo",query:e})},[f,h]=z(!1),y=()=>{B().tagRename(s.value,o.value).then((e=>{f.value=!1,q.success("修改成功"),r({tag:o.value})}))};return(e,a)=>(t(),v("div",he,[g("span",{onClick:a[0]||(a[0]=w((e=>r()),["prevent"])),class:"title"}," MEMO "),u(s)?(t(),v("div",ye,[we,d(g("input",{type:"text",class:"tagEdit","onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e)},null,512),[[p,o.value],[m,u(f)]]),d(g("b",xe,[g("span",null,[g("label",null,b(u(s)),1)])],512),[[m,!u(f)]]),d(n(u(R),{class:"icon",onClick:a[2]||(a[2]=w((e=>f.value=!0),["prevent"]))},null,512),[[m,!u(f)]]),d(n(u(U),{class:"icon",onClick:w(y,["prevent"])},null,8,["onClick"]),[[m,u(f)]])])):T("",!0),n(u(F),{class:"icon",onClick:a[3]||(a[3]=w((e=>r()),["prevent"]))})]))}});Ce.__scopeId="data-v-79554d20",C("data-v-44abf09a");const ke={class:"memo-view"},Le={class:"input-wrapper"},be=g("input",{type:"text"},null,-1),_e={class:"input-container"},Me={class:"card-container"};k();var Ee=e({setup(e){const l=B(),{articleList:o}=r(l),i=c();return s((()=>i.query),(e=>{const{tag:t}=e;t?l.getArticleList({tag:t}):l.getArticleList()}),{immediate:!0}),(e,l)=>(t(),v("div",ke,[g("nav",null,[n(Ce),g("div",Le,[be,g("i",null,[n(u(G))])])]),g("div",_e,[n(se)]),g("ul",Me,[(t(!0),v(h,null,y(u(o),((e,n)=>(t(),a(me,{key:e.id,article:e,isLast:u(o).length-1===n},null,8,["article","isLast"])))),128))])]))}});Ee.__scopeId="data-v-44abf09a";export{Ee as default};
